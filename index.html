<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Magazine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ íƒ€ì´í¬ê·¸ë˜í”¼ & ë ˆì´ì•„ì›ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body{
      font-family:"Hiragino Kaku Gothic ProN",sans-serif;
      background: linear-gradient(
        180deg,
        #ffffff 70%,
        rgba(200, 200, 200, 0.15) 100%
      );
      padding:40px;
      text-align:center;
    }
    .magazine-title{
      font-family:'Georgia',serif;
      font-size:2.5rem;
      color:#000;
      letter-spacing:2px;
      margin-bottom:1em;
      text-shadow:2px 2px 5px rgba(0,0,0,.2);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê°¤ëŸ¬ë¦¬ / ì¹´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .gallery{
      display:flex;
      flex-wrap:wrap;
      gap:20px;
      justify-content:left;
    }
    .card{
      width:260px;
      background:#fff;
      box-shadow:0 4px 10px rgba(0,0,0,.1);
      border-radius:20px;
      overflow:hidden;
      padding-bottom:15px;
    }
    .card img{
      width:100%;
      height:auto;
      border-bottom:1px solid #eee;
      border-radius:20px 20px 0 0;
      cursor:pointer;
    }

    .card:hover {
      box-shadow: 0 12px 32px rgba(0,0,0,0.21), 0 1.5px 6px rgba(0,0,0,.10);
      /* ìœ„ë¡œ ì‚´ì§ ë„ìš°ê¸° */
      transform: translateY(-12px) scale(1.03);
      z-index: 2;
    }
    .caption{
      font-size:1.05rem;
      color:#333;
      padding:10px 15px;
      text-shadow:0 2px 4px rgba(0,0,0,.25);
      line-height:1.6;
    }
    .caption-text{
      position:relative;
      overflow:hidden;
      max-width:100%;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ íˆ´íŒ (ìº¡ì…˜Â·ê²€ìƒ‰) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .search-icon {
      font-size: 1.9rem;    /* ë˜ëŠ” ì›í•˜ëŠ” ê°’, ìˆ«ì í‚¤ìš¸ìˆ˜ë¡ ì»¤ì§ */
      width: 42px;          /* ë˜ëŠ” auto, line-heightì™€ ê°™ì´ ì¡°ì • */
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      /* background: #eee;   // ì›í•  ë•Œ ë°°ê²½ ì¶”ê°€ */
      border-radius: 50%;   /* ì›í˜•, ì„ íƒì‚¬í•­ */
      cursor: pointer;
      /* padding ì¡°ì ˆë¡œ ì•„ì´ì½˜ê³¼ í´ë¦­ì˜ì—­ í‚¤ìš¸ ìˆ˜ë„ ìˆìŒ */
    }
    .caption-text::after,
    .search-icon::after{
      content:attr(data-caption);
      position:absolute;
      bottom:125%;
      left:50%;
      transform:translateX(-50%);
      background:#000;
      color:#fff;
      padding:6px 10px;
      font-size:.75rem;
      border-radius:6px;
      white-space:nowrap;
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease;
      z-index:20;
      box-shadow:0 2px 6px rgba(0,0,0,.3);
      max-width:300px;
    }
    .search-icon::after{content:"Search by keyword";}
    .search-icon:hover,
    /* íˆ´íŒ í™œì„±í™”ëŠ” ì•„ë˜ì²˜ëŸ¼ */
    .caption-text:hover::after,
    .search-icon:hover::after {
      opacity: 1;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal{
      display:none;
      position:fixed;
      inset:0;
      z-index:99;
      background:rgba(0,0,0,.6);
      justify-content:center;
      align-items:center;
    }
    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      max-width: 90vw;
      max-height: 90vh;
      overflow: hidden; /* âœ… ì´ë¯¸ì§€ê°€ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
      text-align: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
    }

    .modal-content.side-by-side {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 30px;
    max-width: 90vw;
    max-height: 90vh;
    padding: 20px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    }

    .modalImgWrap {
      max-width: 50vw;
      max-height: 90vh;
      width: 100%;
      height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative; 
      cursor: grab; 
    }

    .modalImgWrap:active {
      cursor: grabbing;
    }

    /* ì´ë¯¸ì§€ë§Œ í‘œì‹œí•˜ëŠ” ì˜ì—­ - ë‚¨ëŠ” ê³µê°„ ëª¨ë‘ ì‚¬ìš© */
    .modalImgArea {
      flex: 1 1 0;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* ì´ë¯¸ì§€ ë³¸ì²´ */
    .modalImgArea img {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      transition: transform 0.2s ease;
      user-select: none;
      -webkit-user-drag: none;
      border-radius: 10px;
      pointer-events: auto;
    }

    /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ì˜ì—­ */
    .image-controls {
      width: 100%;
      padding-top: 10px;
      padding-bottom: 6px;
      background: #fff; /* í•„ìš”í•˜ë‹¤ë©´ */
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 2;
    }

    .zoom-controls {
      display: flex;
      gap: 8px;
      margin-bottom: 3px;
    }

    .page-indicator {
      font-size: 0.95rem;
      color: #888;
    }

    /* ì˜¤ë¥¸ìª½ metadataì—ëŠ” captionë§Œ ë‚¨ê²Œ */
    .modal-meta {
      flex: 1 1 0;
      min-width: 0;
      overflow-y: auto;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      justify-content: start;
      color: #444;
    }

    .modal-meta .caption {
      font-size: 0.95rem;
      line-height: 1.4;
      color: #444;
    }

    /* í•„ìš”í•˜ë‹¤ë©´ .modal-metaì˜ ë‚˜ë¨¸ì§€ ìš”ì†Œ ìˆ¨ê¸°ê¸° */
    .modal-meta .zoom-controls,
    .modal-meta .page-indicator {
      display: none;
    }

    @media (max-width: 850px), (hover: none) and (pointer: coarse) {
    .modal {
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .modal-content.side-by-side {
      display: flex;
      flex-direction: column;
      height: 90vh; /* ì „ì²´ ëª¨ë‹¬ ë†’ì´ */
      overflow: hidden;
    }

    .modalImgWrap {
      flex: 1 1 auto; /* 90% for image, 10% for caption */
      width: 100%;
      max-width: 90vw;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: auto; 
    }

    .modalImgArea {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modalImgArea img {
      width: 100%;
      height: auto;
      max-width: 100%;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .modal-meta {
      flex: 0 0 10%;
      width: 100%;
      overflow: hidden;
      padding: 5px 1px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-meta .caption {
      width: 100%;
      height: 100%;
      overflow-y: auto;
      font-size: 0.98rem;
      line-height: 1.5;
      color: #444;
      white-space: pre-line;
      word-break: break-word;
      text-align: center;
    }

    .close {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 2rem;
      color: #fff;
      cursor: pointer;
      z-index: 10;
    }
    }

    .close{
      position:absolute;
      top:20px;right:30px;
      font-size:2rem;
      color:#fff;
      cursor:pointer;
    }
    .nav {
    position: absolute;
    top: 50%;
    background: none;
    border: none;
    font-size: 2.5rem;
    color: rgb(212, 212, 212);
    cursor: pointer;
    user-select: none;
    transform: translateY(-50%);
    }

    .nav.prev { left: 20px; }
    .nav.next { right: 20px; }
    .page-indicator {
      color: #ccc;
      font-size: 0.85rem;
      margin: 5px 0;
    }
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‚¬ì´ë“œë°” / í‚¤ì›Œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .container{display:flex;gap:30px;}

    .sidebar-title {
      font-family: 'Georgia', 'Hiragino Kaku Gothic ProN', serif;
      font-size: 15px;
      font-weight: 500;
      color: #222;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding-left: 10px;
      margin-bottom: 12px;
      line-height: 1.2;
      text-shadow:2px 2px 5px rgba(0,0,0,.2);
      border-bottom: 1px solid #eee;
      padding-bottom: 4px;
    }

    .sidebar{
      height: 500px;
      overflow: hidden;
      width:200px;padding-top:20px;font-size:.95rem;
    }
    .sidebar .keyword{
      font-family:'Georgia',serif;
      color:#222;
      cursor:pointer;margin-bottom:10px;
      text-shadow:0 1px 2px rgba(0,0,0,.25);
      background:#f2f2f2;padding:6px 12px;border-radius:6px;
      transition:background .2s ease;
    }
    .sidebar .keyword:hover{background:#ddd;}
    .keywordScroller {
      height: 100%; 
      overflow: hidden;
      position: relative;
    }
    .keywordList {
      display: flex;
      flex-direction: column;
      gap: 10px;
      will-change: transform;
    }
    .sidebar:hover .keywordList {
      animation-play-state: paused;
    }
    @keyframes slide-vertical {
      from { transform: translateY(0); }
      to   { transform: translateY(-50%); }
    }

    .card-keywords {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 10px; /* ì¤„ë°”ê¿ˆ/ì¢Œìš° ê°„ê²© */
      margin-top: 24px;
      margin-bottom: 6px;
      justify-content: left; /* ì¹´ë“œê¸€, ìº¡ì…˜ ì™¼ìª½ ì •ë ¬ ì‹œ */
      max-height: 130px;        /* ê³ ì • ë†’ì´ (ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ì¡°ì •, ì˜ˆ: 2ì¤„ ì •ë„) */
      overflow-y: auto;        /* yì¶•ìœ¼ë¡œ ë„˜ì–´ê°€ë©´ ìŠ¤í¬ë¡¤ */
      overflow-x: hidden;      /* xì¶•ìœ¼ë¡œëŠ” ëª» ë„˜ì¹˜ê²Œ */
    }

    .keyword {
      font-size: 0.97em;
      background: #f3f4f8;
      color: #5191fa;
      border-radius: 14px;
      padding: 5px 13px;
      font-weight: 500;
      letter-spacing: 0.02em;
      border: 1px solid #dde3ed;
      box-shadow: 0 1px 2px #0002;
      transition: background 0.2s, color 0.2s;
    }
    .keyword:hover {
      background: #dde6f8;
      color: #1c3772;
    }
    .keyword.active {
      background: black;
      color: white;
      font-weight: bold;
    }
    /* ìŠ¤í¬ë¡¤ë°”ê°€ ë„ˆë¬´ ë‘ê»ê²Œ ë‚˜ì˜¬ ê²½ìš°, ì˜ˆìœ ìŠ¤í¬ë¡¤ë°”ë„ ì¶”ê°€ ê°€ëŠ¥ (í¬ë¡¬/ì—£ì§€/ì‚¬íŒŒë¦¬) */
    .card-keywords::-webkit-scrollbar {
      height: 0;
      width: 6px;
    }
    .card-keywords::-webkit-scrollbar-thumb {
      background: #dde3ed;
      border-radius: 8px;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .menu {
      display: flex;
      flex-direction: column;  /* âœ… ìˆ˜ì§ ë°°ì—´ */
      gap: 10px;
      align-items: flex-end;   /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
    }
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê²€ìƒ‰ë°•ìŠ¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .search-box{
      position:absolute;top:40px;right:15px;z-index:10;
      display:flex;align-items:center;gap:10px;
    }
    .search-box input{
      padding:8px 12px;font-size:1.15rem;border-radius:6px;border:1px solid #ccc;
      box-shadow:0 2px 4px rgba(0,0,0,.1);
      transition:width .3s ease,opacity .2s ease;
      width:0;opacity:0;pointer-events:none;
    }
    .search-box.active input{width:200px;opacity:1;pointer-events:all;}

    
    .zoom-controls {
      margin-bottom: 10px;
    }

    .zoom-controls button {
      font-size: 1.2rem;
      margin-right: 10px;
      padding: 6px 12px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background: #eee;
      transition: background 0.2s;
    }

    .zoom-controls button:hover {
      background: #ddd;
    }
  </style>
</head>
<body>
  <div class="magazine-title">MAGAZINE</div>

  <!-- ì‚¬ì´ë“œë°” & ê°¤ëŸ¬ë¦¬ -->
  <div class="container">
    <aside class="sidebar" style="height: 660px; overflow: hidden;">
      <div class="sidebar-title">Activate a Topic ğŸ–²ï¸</div>  
      <div class="keywordScroller">
        <div class="keywordList"></div>
      </div>
    </aside>
    <div class="main-content">  
    <!-- ğŸ” ê²€ìƒ‰ -->
    <div class="menu">
      <div class="search-box" id="searchBox">
        <span class="search-icon" id="searchIcon">ğŸ”</span>
        <input type="text" id="searchInput" placeholder="Search by keywordâ€¦" />
      </div>
    </div>
      <section class="gallery" id="gallery"></section>
    </div>
  </div>

<!-- ëª¨ë‹¬ ë·°ì–´ -->
<div class="modal" id="slideModal" aria-hidden="true">
  <!-- ë‹«ê¸° ë²„íŠ¼ -->
  <button class="close" id="modalClose" aria-label="close">Ã—</button>

  <div class="modal-content side-by-side">
    <div class="modalImgWrap" id="modalImgWrap">
      <div class="modalImgArea">
        <img id="modalImage" alt="Slide" />
      </div>
      <div class="image-controls">
        <div class="zoom-controls">
          <button id="zoomIn">ï¼‹</button>
          <button id="zoomOut">âˆ’</button>
        </div>
        <div class="page-indicator" id="modalPageIndicator"></div>
      </div>
    </div>
  
    <!-- ìš°ì¸¡ì—” captionë§Œ -->
    <div class="modal-meta">
      <div class="caption" id="modalCaption"></div>
    </div>
  </div>

  <!-- ì´ë¯¸ì§€ ì „í™˜ ë„¤ë¹„ê²Œì´ì…˜ -->
  <button class="nav prev" id="modalPrev" aria-label="previous image">â†</button>
  <button class="nav next" id="modalNext" aria-label="next image">â†’</button>
</div>

  <!-- ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„° (imageData ë³€ìˆ˜ ì •ì˜) -->
  <script src="metadata.js"></script>

  <!-- ê°¤ëŸ¬ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
  /* ========================== ìœ í‹¸ ========================== */
  /** HTML attributeìš© ìµœì†Œ ì´ìŠ¤ì¼€ì´í”„ */
  function escapeCSSAttr(str) {
    return str
      .replace(/\\/g, "\\\\")      // must go first!
      .replace(/"/g, "\\0022 ")    // "
      .replace(/'/g, "\\0027 ")    // '
      .replace(/</g, "")           // strip <
      .replace(/>/g, "")           // strip >
      .replace(/\n/g, " ")         // newlines to space
      .replace(/&/g, "&");         // optional: entity pass-through
  }

  const escapeAttr = s=>s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[\r\n]+/g," ");

  /* ========================== DOM ìºì‹œ ========================== */
  const gallery      = document.getElementById('gallery');
  const keywordPanel = document.getElementById('keywordPanel');
  const searchBox    = document.getElementById('searchBox');
  const searchInput  = document.getElementById('searchInput');
  const searchIcon   = document.getElementById('searchIcon');

  const modal        = document.getElementById('slideModal');
  const modalImg     = document.getElementById('modalImage');
  const modalCap     = document.getElementById('modalCaption');
  const modalClose   = document.getElementById('modalClose');

  /* ========================== ëª¨ë‹¬ ========================== */
  let modalImageList = [];
  let modalIndex = 0; 
  let slideIndex = 0;

  function openModal(srcList, caption, date, index) {
    // index: ì „ì²´ ìŠ¬ë¼ì´ë“œ ë¦¬ìŠ¤íŠ¸ ì¤‘ì—ì„œ modalì˜ index
    if (!Array.isArray(srcList)) srcList = [srcList]; // ë‹¨ì¼ ì´ë¯¸ì§€ì¼ ê²½ìš°

    const modalId = `modal-${index}`;  // ê° ëª¨ë‹¬ì— ê³ ìœ  ID ë¶€ì—¬


    modalImageList = srcList;

    updateModalImage();
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden', 'false');

    document.body.style.overflow = 'hidden';
  }

  function closeModal(){
  document.activeElement.blur(); 
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden', 'true');
  document.body.style.overflow = 'auto';
  window.history.pushState("", "", window.location.pathname); // í•´ì‹œ ì œê±°
  slideIndex = 0;
  modalIndex = 0 ;  
  }
  modalClose.addEventListener('click', closeModal);
  window.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });

  /* ========================== ê°¤ëŸ¬ë¦¬ ë Œë” ========================== */
  function renderGallery(list) {
  gallery.innerHTML = '';
  list.forEach(data => {
    const card = document.createElement('div');
    card.className = 'card';

    // âœ… ëŒ€í‘œ ì´ë¯¸ì§€ (ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¡œ í‘œì‹œ)
    const img = document.createElement('img');
    img.src = data.filename;  // e.g. "title.png"
    img.alt = data.caption;

    // âœ… í´ë¦­ ì‹œ ì „ì²´ ì‹œë¦¬ì¦ˆë¥¼ openModalì— ì „ë‹¬
    img.addEventListener('click', () => {

      modalIndex = list.indexOf(data);   
      const totalImages = data.imageCount; 
      const filenames = [];

      for (let i = 0; i < totalImages; i++) {
        const suffix = i === 0 ? '' : `_${i + 1}`;
        const filename = data.filename.replace(/\.png$/, `${suffix}.png`);
        filenames.push(filename);
      }

      window.location.hash = `#/${modalIndex + 1}`;

      openModal(filenames, data.caption, data.date, modalIndex);
      
    });

    // âœ… ìº¡ì…˜ ì˜ì—­
    const capWrap = document.createElement('div');
    capWrap.className = 'caption';

    const keywordEl = document.createElement('div');
    keywordEl.className = 'card-keywords'; // .caption-text ë³´ë‹¨ .card-keywords ë“±ìœ¼ë¡œ ë³„ë„ ë¶„ë¦¬ ì¶”ì²œ

    data.keywords.forEach(k => {
      const span = document.createElement('span');
      span.className = 'keyword';
      span.textContent = '#' + k.toLowerCase();
      keywordEl.appendChild(span);
    });

    // ë°ì´í„° ì†ì„±ì€ í•œ ì¤„ë¡œ ì „ì²´ ìŠ¤íŠ¸ë§ ì¡°í•©í•´ ì €ì¥
    const keywordsText = '#' + data.keywords.map(k => k.toLowerCase()).join(' #');
    keywordEl.setAttribute('data-keywords', escapeCSSAttr(keywordsText));

    const dateSmall = document.createElement('small');
    dateSmall.textContent = data.date;

    capWrap.append(keywordEl, dateSmall);
    card.append(img, capWrap);
    gallery.append(card);

    handleHashRouting();
  });
  }

  /* ========================== í‚¤ì›Œë“œ íŒ¨ë„ ========================== */
  const keywords = [...new Set(imageData.flatMap(i=>i.keywords.map(k=>k.toLowerCase())))];
  const keywordListDiv = document.querySelector('.sidebar .keywordList');
  const container = document.querySelector('.keywordScroller');
  const list = container.querySelector('.keywordList');
  
  // ğŸ”¥ í‚¤ì›Œë“œ ë Œë”ë§ + ì´ë²¤íŠ¸ ì—°ê²°
  function renderKeywords() {
    list.innerHTML = "";

    for (let repeat = 0; repeat < 2; repeat++) {
      keywords.forEach(k => {
        const btn = document.createElement('div');
        btn.className = 'keyword';
        btn.textContent = '#' + k;

        // âœ… í´ë¦­ ì´ë²¤íŠ¸
        btn.addEventListener('click', (e) => {
          e.stopPropagation();  // âœ… ì¤‘ìš”
          const keyword = e.currentTarget.dataset.keyword;
          filterByKeyword(keyword);
          filterByKeyword(k);
        });

        list.appendChild(btn);
      });
    }
  }

  // ğŸš€ ì´ˆê¸° ì‹¤í–‰
  renderKeywords();

  // ğŸ” í‚¤ì›Œë“œ í•„í„°ë§ í•¨ìˆ˜
  function filterByKeyword(k) {

    const filtered = imageData.filter(i =>
      i.keywords.map(x => x.toLowerCase()).includes(k)
    );
    
    renderGallery(filtered);

    // ğŸ”¥ ì„ íƒëœ í‚¤ì›Œë“œ ê°•ì¡°
    document.querySelectorAll('.keyword').forEach(el => {
      const label = el.textContent.replace(/^#/, '').toLowerCase();
      el.classList.toggle('active', label === k);
    });
  }


  // ë†’ì´ ê³„ì‚°
  const singleListHeight = list.scrollHeight / 2;

  let pos = 0;
  let speed = 0.5; // í”½ì…€/í”„ë ˆì„ (ì¡°ì ˆ ê°€ëŠ¥)
  let autoScroll = true;

  function animate() {
    if (autoScroll) {
      pos += speed;
      if (pos >= singleListHeight) {
        pos = 0; // ì™„ì „ seamless!
      }
      list.style.transform = `translateY(-${pos}px)`;
    }
    requestAnimationFrame(animate);
  }

  container.addEventListener('mouseenter', () => autoScroll = false);
  container.addEventListener('mouseleave', () => autoScroll = true);

  animate();



  /* ========================== ê²€ìƒ‰ ========================== */
  function toggleSearch(){
    searchBox.classList.toggle('active');
    if(searchBox.classList.contains('active')) searchInput.focus();
    else{
      searchInput.value='';
      renderGallery(imageData);
    }
  }
  searchIcon.addEventListener('click',toggleSearch);
  searchInput.addEventListener('input',()=>{
    const q = searchInput.value.toLowerCase();
    renderGallery(imageData.filter(item=>
      Array.isArray(item.keywords)&&item.keywords.some(k=>k.toLowerCase().includes(q))
    ));
  });
  // í¬ì»¤ìŠ¤ ë°– í´ë¦­ ì‹œ ê²€ìƒ‰ì°½ ë‹«ê¸°
  document.addEventListener('click', e => {
  // ê²€ìƒ‰ì°½ì´ ì—´ë ¤ ìˆê³  + ì™¸ë¶€ í´ë¦­ì¼ ë•Œë§Œ ì‹¤í–‰
    if (searchBox.classList.contains('active') && !searchBox.contains(e.target)) {
      searchBox.classList.remove('active');
      searchInput.value = '';
      renderGallery(imageData);
    }
  });

  document.addEventListener('keydown', (e) => {
  if (modal.style.display !== 'flex') return;

  if (e.key === 'ArrowRight') {
    slideIndex = (slideIndex + 1) % modalImageList.length;
    updateModalImage();
  } else if (e.key === 'ArrowLeft') {
    slideIndex = (slideIndex - 1 + modalImageList.length) % modalImageList.length;
    updateModalImage();
  } else if (e.key === 'Escape') {
    closeModal();
  }
  });
  document.getElementById('modalPrev').addEventListener('click', () => {
  slideIndex = (slideIndex - 1 + modalImageList.length) % modalImageList.length;
  updateModalImage();
  });
  document.getElementById('modalNext').addEventListener('click', () => {
    slideIndex = (slideIndex + 1) % modalImageList.length;
    updateModalImage();
  });
  document.getElementById('modalClose').addEventListener('click', () => {
    closeModal();
  });


  // ===== DOM References =====
  const imgWrap = document.getElementById('modalImgWrap');
  const pageIndicator = document.getElementById('modalPageIndicator');

  // ===== State Variables =====
  let zoomScale = 1;
  let translateX = 0;
  let translateY = 0;
  let isDragging = false;
  let startX = 0;
  let startY = 0;


  // ====== Update Image Display ======
  function updateModalImage() {
    modalImg.src = modalImageList[slideIndex];
    modalImg.alt = `Image ${slideIndex + 1}`;
    pageIndicator.textContent = `Page ${slideIndex + 1} of ${modalImageList.length}`;
    modalCap.textContent = imageData[modalIndex].caption; // â˜…ì—¬ê¸°ë¥¼ ì ì ˆíˆ!
    resetZoom();
  }

  // ====== Zoom & Pan Logic ======
  function updateTransform() {
    modalImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${zoomScale})`;
  }

  function resetZoom() {
    zoomScale = 1;
    translateX = 0;
    translateY = 0;
    updateTransform();
  }

  document.getElementById('zoomIn').addEventListener('click', () => {
    zoomScale = Math.min(zoomScale + 0.1, 3);  // ìµœëŒ€ 3ë°°ê¹Œì§€ í™•ëŒ€
    updateTransform();
  });

  document.getElementById('zoomOut').addEventListener('click', () => {
    zoomScale = Math.max(zoomScale - 0.1, 0.5);  // ìµœì†Œ 0.5ë°°ê¹Œì§€ ì¶•ì†Œ
    updateTransform();
  });


  // ====== Wheel Zoom ======
  modalImg.addEventListener('wheel', (e) => {
    const zoomStep = 0.1;
    const prevZoom = zoomScale;

    if (e.deltaY > 0) {
      zoomScale = Math.max(zoomScale - zoomStep, 0.5);
    } else {
      zoomScale = Math.min(zoomScale + zoomStep, 3);
    }
    // í¬ì¸í„° ê¸°ì¤€ pan ë³´ì •
    const imgRect = modalImg.getBoundingClientRect();
    const cx = (e.clientX - imgRect.left) / imgRect.width;
    const cy = (e.clientY - imgRect.top) / imgRect.height;
    const scaleRatio = zoomScale / prevZoom;

    translateX -= (cx * imgRect.width) * (scaleRatio - 1);
    translateY -= (cy * imgRect.height) * (scaleRatio - 1);
    
    updateTransform();
  });

  // ====== Click + Drag Pan ======
  imgWrap.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.clientX - translateX;
    startY = e.clientY - translateY;
    imgWrap.style.cursor = 'grabbing';
  });

  window.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    translateX = e.clientX - startX;
    translateY = e.clientY - startY;
    updateTransform();
  });

  window.addEventListener('mouseup', () => {
    isDragging = false;
    imgWrap.style.cursor = 'grab';
  });


  
  /* ========================== ì´ˆê¸° í˜¸ì¶œ ========================== */
  
  window.addEventListener('DOMContentLoaded', () => {
    renderGallery(imageData);
  });

  window.addEventListener('hashchange', () => {
    handleHashRouting(); // URL í•´ì‹œ ë³€ê²½ë  ë•Œ
  });

  function handleHashRouting() {
    const match = location.hash.match(/^#\/(\d+)$/);
    if (!match) return;
    
    const index = parseInt(match[1], 10) - 1;
    const data = imageData[index];
    if (!data) return;

    const filenames = [];
    for (let i = 0; i < data.imageCount; i++) {
      const suffix = i === 0 ? '' : `_${i + 1}`;
      const filename = data.filename.replace(/\.png$/, `${suffix}.png`);
      filenames.push(filename);
    }

    openModal(filenames, data.caption, data.date, index);
  }

  document.getElementById('modalClose').addEventListener('click', () => {
  closeModal();
  window.location.hash = ''; // í™ˆìœ¼ë¡œ ë³µê·€
  });


  </script>
</body>
</html>
